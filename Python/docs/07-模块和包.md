# 模块和包

Python 的模块系统允许将代码组织成可重用的单元。

## 模块（Module）

### 什么是模块

模块是一个包含 Python 代码的文件（`.py` 文件）。

```python
# math_utils.py - 数学工具模块
"""数学工具模块"""

PI = 3.14159

def add(a, b):
    """加法函数"""
    return a + b

def multiply(a, b):
    """乘法函数"""
    return a * b

class Calculator:
    """计算器类"""
    def __init__(self):
        self.result = 0
```

### 导入模块

```python
# 方式1：导入整个模块
import math_utils
result = math_utils.add(1, 2)

# 方式2：导入特定函数/类
from math_utils import add, multiply
result = add(1, 2)

# 方式3：导入所有（不推荐）
from math_utils import *
result = add(1, 2)

# 方式4：使用别名
import math_utils as mu
result = mu.add(1, 2)

from math_utils import add as addition
result = addition(1, 2)
```

### 标准库模块

```python
# 导入标准库模块
import os          # 操作系统接口
import sys         # 系统相关参数和函数
import math        # 数学函数
import datetime    # 日期和时间
import json        # JSON 处理
import re          # 正则表达式
import random      # 随机数生成

# 使用示例
import math
print(math.pi)           # 3.141592653589793
print(math.sqrt(16))     # 4.0

from datetime import datetime
now = datetime.now()
print(now)
```

### 模块搜索路径

```python
import sys
print(sys.path)  # 显示模块搜索路径

# 添加自定义路径
sys.path.append('/path/to/your/modules')
```

### `__name__` 和 `__main__`

```python
# my_module.py
def function():
    print("这是模块中的函数")

# 如果直接运行此文件，__name__ 为 '__main__'
# 如果被导入，__name__ 为模块名
if __name__ == "__main__":
    print("直接运行此模块")
    function()
else:
    print("被导入为模块")
```

## 包（Package）

### 什么是包

包是包含多个模块的目录，必须包含 `__init__.py` 文件。

```
mypackage/
    __init__.py
    module1.py
    module2.py
    subpackage/
        __init__.py
        module3.py
```

### 创建包

```python
# mypackage/__init__.py
"""包的初始化文件"""
from .module1 import function1
from .module2 import Class1

__version__ = "1.0.0"
__all__ = ['function1', 'Class1']  # 定义 from package import * 时导入的内容
```

### 导入包

```python
# 导入包中的模块
import mypackage.module1
mypackage.module1.function1()

# 从包中导入
from mypackage import module1
module1.function1()

# 从包中导入特定内容
from mypackage.module1 import function1
function1()

# 导入子包
from mypackage.subpackage import module3
```

## 实际应用场景 Demo

### Demo 1: 创建自定义工具包

```python
# utils/__init__.py
"""工具包"""
from .string_utils import *
from .math_utils import *

__version__ = "1.0.0"

# utils/string_utils.py
"""字符串工具模块"""
def reverse_string(s):
    """反转字符串"""
    return s[::-1]

def capitalize_words(s):
    """单词首字母大写"""
    return ' '.join(word.capitalize() for word in s.split())

# utils/math_utils.py
"""数学工具模块"""
def factorial(n):
    """计算阶乘"""
    if n <= 1:
        return 1
    return n * factorial(n - 1)

def fibonacci(n):
    """计算斐波那契数列"""
    if n <= 1:
        return n
    a, b = 0, 1
    for _ in range(2, n + 1):
        a, b = b, a + b
    return b

# 使用包
# main.py
from utils import reverse_string, factorial

print(reverse_string("Python"))  # nohtyP
print(factorial(5))              # 120
```

### Demo 2: 配置管理模块

```python
# config.py
"""配置管理模块"""
import os
from pathlib import Path

class Config:
    """配置类"""
    def __init__(self):
        self.base_dir = Path(__file__).parent
        self.data_dir = self.base_dir / "data"
        self.log_dir = self.base_dir / "logs"
        
        # 从环境变量读取配置
        self.debug = os.getenv("DEBUG", "False").lower() == "true"
        self.database_url = os.getenv("DATABASE_URL", "sqlite:///db.sqlite")
    
    def get(self, key, default=None):
        """获取配置值"""
        return getattr(self, key, default)

# 创建全局配置实例
config = Config()

# 使用配置
# main.py
from config import config

print(f"调试模式: {config.debug}")
print(f"数据库URL: {config.database_url}")
```

## 相对导入和绝对导入

```python
# 绝对导入（推荐）
from mypackage.module1 import function1

# 相对导入（在包内部使用）
from .module1 import function1      # 当前包
from ..parent import something      # 父包
from .subpackage.module3 import func  # 子包
```

## 模块重载

```python
import importlib
import my_module

# 重新加载模块（开发时有用）
importlib.reload(my_module)
```

## 下一步

完成模块和包学习后，建议学习：
1. [异常处理](./08-异常处理.md) - 异常类型和处理
2. [文件操作](./09-文件操作.md) - 文件读写、路径处理

